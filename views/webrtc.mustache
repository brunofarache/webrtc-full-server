<!DOCTYPE html>
<html>
	<head>
		<script src="http://webrtc.googlecode.com/svn/trunk/samples/js/base/adapter.js"></script>
		<script src="http://yui.yahooapis.com/3.10.3/build/yui/yui-min.js"></script>
		<script src="javascripts/webrtc/webrtc-min.js"></script>
		<script type="text/javascript">
			YUI({
				modules: {
					socket_io: {
						fullpath: '/socket.io/socket.io.js'
					}
				}
			}).use('webrtc', function(Y) {
				var stream = new Y.WebRTC();
				
				stream.setLocal('vid1');

				var id = window.location.pathname.match(/\/(\d+)/);
				if (id !== null) stream.setId(id[1]);

				var numStreams = 1;

				stream.onConnection(function() {
					numStreams++;
					Y.one('#streams').append('<video id="vid' + numStreams + '" width="400px" autoplay></video>');
					stream.addRemote('vid' + numStreams);
				});
				
				stream.startStream('both', function(id) {
					Y.one('body').append('<a href="/' + id + '" target="_blank">Link to this stream</a>');

					stream.onMessage(function(message) {
						Y.one('body').append('<br>' + message.data);
					});
				});

				Y.one('#pause').on('click', function() {
					if (stream.isStreaming())
						stream.pause();
					else
						stream.resume();
				});

				Y.one('#sendMessage').on('click', function() {
					stream.send(Y.one('#message').get('value'));
				});

				// moca
				// jasmen
				// arrow - functional
				// vows

				// videoStream.muteLocal();
				// videoStream.muteRemote();
				// videoStream.mute();
				// videoStream.pauseLocal();
				// videoStream.pauseRemote();
				// videoStream.pause();
				// videoStream.resumeLocal();
				// videoStream.resumeRemote();
				// videoStream.resume();
				// videoStream.getID();
				// videoStream.setID('room id');
				// videoStream.setICEServers({'stun:stun.l.google.com:19302'});

				// videoStream.send('test');
				// videoStream.on('message', function(data) {

				// });
				
			});
		</script>
	</head>
	<body>
		<div id="container">
			<div id="streams">
			  	<video id="vid1" width="400px" autoplay></video>
			</div>
			<input type="button" id="pause" value="pause/play">
			<input type="text" id="message">
			<input type="button" id="sendMessage" value="send">
		</div>
	</body>
</html>