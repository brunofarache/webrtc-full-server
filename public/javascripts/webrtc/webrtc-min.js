YUI.add("webrtc",function(e,t){function y(){}var n=io.connect("/"),r,i,s,o,u={url:"stun:stun.l.google.com:19302"},a=null,f=null,l="",c=-1,h=!1,p=null,d=null,v=!1,m=[],g=!0;y.prototype={startStream:function(e,t){var n={iceServers:[u]},r={optional:[{RtpDataChannels:!0}]};i=new RTCPeerConnection(n,r),thisWebRTC=this,e=="both"||e=="media"||typeof e===undefined?thisWebRTC._startLocalStream(function(){i.addStream(p),i.onaddstream=function(e){d=e.stream,attachMediaStream(f,d),h=!0};if(e=="both"||typeof e===undefined)o=i.createDataChannel("test",{reliable:!1}),thisWebRTC._startDataChannel();thisWebRTC._makeConnection(t)}):e=="data"&&(o=i.createDataChannel("test",{reliable:!1}),thisWebRTC._startDataChannel(),thisWebRTC._makeConnection(t))},setDataChannelCallback:function(e){o.onmessage=e},send:function(e){v?o.send(e):m.push(e)},setLocal:function(e){a=document.getElementById(e)},setRemote:function(e){f=document.getElementById(e)},pause:function(){i.removeStream(p),this._updateDescription(),h=!1},isStreaming:function(){return paused},resume:function(){i.addStream(p),this._updateDescription(),h=!0},mute:function(){},getId:function(){return l},setId:function(e){g=!1,l=e},setIceServers:function(e){typeof e=="array"?_ice_servers=e:_ice_servers=[e]},isStreaming:function(){return _streaming},_startLocalStream:function(e){getUserMedia({audio:!0,video:!0},function(t){p=t,attachMediaStream(a,p),e()})},_startDataChannel:function(){o.onmessage=null,o.onopen=function(){v=!0;for(var e=0;e<m.length;e++)o.send(m[e])}},_makeConnection:function(e){var t=this;i.onicecandidate=function(e){e.candidate&&n.emit("cand",{client_id:client_id,cand:e.candidate,id:s})},n.emit("join",{id:l}),n.on("joined",function(n){client_id=n.client_id,s=n.id,l===""&&t._updateDescription(),e(s)}),n.on("add_desc",function(e){client_id=e.client_id,s=e.id,i.setRemoteDescription(new RTCSessionDescription(e.desc)),_streaming=!0,l!==""&&i.createAnswer(function(e){i.setLocalDescription(e),n.emit("desc",{client_id:client_id,desc:e,id:s})})}),n.on("add_cand",function(e){i.addIceCandidate(new RTCIceCandidate(e.cand))})},_updateDescription:function(){i.createOffer(function(e){i.setLocalDescription(e),n.emit("desc",{client_id:client_id,desc:e,id:s})},null)}},e.WebRTC=y},"@VERSION@",{requires:["node","socket_io"]});
